#+TITLE: Sway dispatch
#+AUTHOR: Rafael Ito
#+PROPERTY: header-args :tangle sway-dispatch.sh
#+DESCRIPTION: script meant to work the same way of xremap in respect to sending different keypresses according to the focused application
#+STARTUP: showeverything
#+auto_tangle: t

* Table of Contents :toc_3:
- [[#header][Header]]
- [[#change-window-focus][Change window focus]]
- [[#change-output-focus][Change output focus]]
- [[#kill-window][Kill window]]
- [[#cutcopypaste][Cut/Copy/Paste]]
  - [[#cut][Cut]]
  - [[#copy][Copy]]
  - [[#paste][Paste]]
- [[#fullscreen][Fullscreen]]
- [[#new-terminal][New terminal]]

* Header :noexport_1:
** Shebang
#+begin_src sh
#!/usr/bin/env bash
#+end_src
** Shared group
:PROPERTIES:
:header-args: :padline no :tangle sway-dispatch.sh
:END:
#+begin_src sh :padline yes
shopt -s extglob  # enable special variable syntax
#+end_src
*** Terminals
#+begin_src sh :padline yes
TERMINAL_LIST=(
    "kitty"
    "dropdown_terminal"
    "dropdown_python"
)
#+end_src
*** Browsers
#+begin_src sh
BROWSER_LIST=(
    "/brave.*/"
    "/firefox.*/"
    "chromium"
)
#+end_src
*** Scratchpads
#+begin_src sh
SCRATCHPAD_LIST=(
    "dropdown_terminal"
    "dropdown_python"
    "scrcpy"
    "Brave-browser-beta"
    "Keymapp"
    "keymapp"
)
#+end_src
*** Emacs over SSH
#+begin_src sh
EMACS_SSH_LIST=(
    "/.*: emacsclient --create-frame.* --alternate-editor=.*emacs.*/"
    "/.*: emacsclient -c.* -a .*emacs.*/"
    "/.*: ecd/"
    "/.*: ec/"
)
#+end_src
*** Cedilla
#+begin_src sh
CEDILLA_LIST=(
    "/brave.*/"
    "chromium"
)
#+end_src
*** Merge list with "|"
#+begin_src sh :padline yes
IFS='|'  # set separator to pipe temporarily
TERMINALS="@(${TERMINAL_LIST[*]})"
BROWSERS="@(${BROWSER_LIST[*]})"
SCRATCHPADS="@(${SCRATCHPAD_LIST[*]})"
EMACS_SSHS="@(${EMACS_SSH_LIST[*]})"
CEDILLAS="@(${CEDILLA_LIST[*]})"
unset IFS  # reset separator
#+end_src
** Help menu
#+begin_src sh
# Usage:
# ./smart_dispatch.sh focus left
# ./smart_dispatch.sh type symbol
# ./smart_dispatch.sh launch
#+end_src
** Parse parameters
#+begin_src sh
COMMAND="$1"
PARAM="$2"

# get the app_id of the focused window
# some XWayland apps might have null app_id, so we fallback to window_properties.class if needed
FOCUSED_APP=$(swaymsg -t get_tree | jq -r '.. | select(.focused? == true) | if .app_id then .app_id else .window_properties.class end')
#+end_src
** Dispatcher
#+begin_src sh
case "$COMMAND" in
#+end_src
* Change window focus
#+begin_src sh
"focus")
    DIRECTION="$PARAM"
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -s efs --suppress-output --eval "(evil-window-$DIRECTION 1)" ;;
        [Ee]macs*) ;;
        *) swaymsg focus "$DIRECTION" ;;
    esac
    ;;
#+end_src
* Change output focus
#+begin_src sh
"focus_output")
    DIRECTION="$PARAM"
    # check if there is only one screen (lan-mouse client)
    if [[ $(swaymsg -t get_outputs | jq length) -eq 1 ]]; then
        swaymsg exec $XDG_CONFIG_HOME/scripts/lanmouse-switch.sh $DIRECTION
    # proceed with normal output focus switch
    else
        swaymsg focus output $DIRECTION
    fi
    ;;
#+end_src
* Kill window
#+begin_src sh
"kill")
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -s efs --suppress-output --eval "(evil-quit)" ;;
        [Ee]macs*) ;;
        *) "$HOME/.config/scripts/hide-or-kill.sh" ;;
    esac
    ;;
#+end_src
* Cut/Copy/Paste
** Cut
#+begin_src sh
"cut")
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -s efs --suppress-output --eval "(execute-extended-command 1)" ;;
        [Ee]macs*) ;;
        $TERMINALS) ydotool key 29:1 42:1 45:1 45:0 42:0 29:0 ;; # C-S-x
        ,*) ydotool key 29:1 45:1 45:0 29:0 ;; # C-x
    esac
    ;;
#+end_src
** Copy
#+begin_src sh
"copy")
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -s efs --suppress-output --eval "(evil-yank)" ;;
        [Ee]macs*) ;;
        $TERMINALS) ydotool key 29:1 42:1 46:1 46:0 42:0 29:0 ;; # C-S-c
        *) ydotool key 29:1 46:1 46:0 29:0 ;; # C-c
    esac
    ;;
#+end_src
** Paste
#+begin_src sh
"paste")
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -s efs --suppress-output --eval "(evil-paste-after 1)" ;;
        [Ee]macs*) ;;
        $TERMINALS) ydotool key 29:1 42:1 47:1 47:0 42:0 29:0 ;; # C-S-v
        *) ydotool key 29:1 47:1 47:0 29:0 ;; # C-v
    esac
    ;;
#+end_src
* Fullscreen
#+begin_src sh
"fullscreen")
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -s efs --suppress-output --eval "(zoom-window-zoom)" ;;
        [Ee]macs*) ;;
        *) swaymsg fullscreen toggle ;;
    esac
    ;;
#+end_src
* New terminal
#+begin_src sh
"new_terminal")
    case "$FOCUSED_APP" in
        #[Ee]macs*) emacsclient -n -s efs --suppress-output --eval "(progn (split-window-autotiling) (other-window 1) (counsel-find-file))" ;;
        [Ee]macs*) ;;
        *) kitty ;;
    esac
    ;;
#+end_src
(global-set-key (kbd "M-s-g") '(lambda () (interactive) (split-window-autotiling) (other-window 1) (counsel-find-file)))

* EoS :noexport:
#+begin_src sh
esac
#+end_src
